<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Multiplayer Poker - Final Edition</title>
    <!-- Cache Busting Versioning -->
    <link rel="stylesheet" href="style.css?v=FIN_REV">
</head>

<body>
    <div id="app">
        <!-- Error Reporting (Hidden by default) -->
        <div id="debug-log"
            style="position:fixed; top:0; left:0; width:100%; max-height:80px; background:rgba(255,0,0,0.9); color:white; z-index:9999; overflow:auto; display:none; font-size:11px; padding:5px;">
        </div>
        <script>
            window.addEventListener('error', (e) => {
                const d = document.getElementById('debug-log');
                d.style.display = 'block';
                d.innerText += "Error: " + e.message + " at " + e.filename + ":" + e.lineno + "\n";
            });
            window.addEventListener('unhandledrejection', (e) => {
                const d = document.getElementById('debug-log');
                d.style.display = 'block';
                d.innerText += "Promise Error: " + e.reason + "\n";
            });
        </script>

        <!-- Lobby Screen -->
        <div id="lobby" class="screen active">
            <h1>Pƒ∞SANO POKER</h1>
            <div class="lobby-controls">
                <div class="player-select">
                    <label for="player-count">Table Capacity:</label>
                    <select id="player-count">
                        <option value="2">2 Players (Heads Up)</option>
                        <option value="3">3 Players</option>
                        <option value="4">4 Players</option>
                        <option value="5">5 Players</option>
                        <option value="6">6 Players</option>
                        <option value="9">9 Players (Full Table)</option>
                    </select>
                </div>

                <div class="player-identity">
                    <div class="input-group-custom" style="position:relative; display:flex;">
                        <input type="text" id="player-name" placeholder="Enter Your Nickname..." maxlength="12"
                            autocomplete="off" style="border-radius: 8px 0 0 8px; margin:0; flex:1;">
                        <button id="btn-toggle-names"
                            style="width:40px; border-radius: 0 8px 8px 0; margin:0; background:#333; border:1px solid #444; color:#f2c94c;">‚ñº</button>
                        <div id="custom-name-list" class="name-dropdown"
                            style="display:none; position:absolute; top:100%; left:0; width:100%; max-height:150px; overflow-y:auto; background:#222; border:1px solid #444; z-index:100; border-radius:8px;">
                        </div>
                    </div>
                    <label class="save-check" style="margin-top:5px;">
                        <input type="checkbox" id="save-name-default" checked> Remember Device
                    </label>
                    <button id="btn-show-stats" class="secondary-btn" style="margin-top: 5px;">Player Profile</button>
                </div>

                <div class="main-actions">
                    <button id="btn-create" style="width:100%; margin-bottom:10px;">CREATE NEW ROOM</button>
                    <div class="join-form" style="display:flex; gap:5px;">
                        <input type="text" id="inp-room-code" placeholder="Code..." maxlength="6" style="flex:1;">
                        <button id="btn-join">JOIN</button>
                    </div>
                </div>
            </div>
            <p class="status-msg" id="lobby-msg"></p>
        </div>

        <!-- Game Screen -->
        <div id="game" class="screen">
            <div class="header">
                <div class="room-info">Room: <span id="display-room-code"></span> | <span
                        id="player-count-display"></span></div>
                <div id="btn-open-guide">üé¥ Hands Guide</div>
                <div class="pot-info">POT: $<span id="pot-amount">0</span></div>
            </div>

            <div id="opponents-container">
                <!-- Opponents populate here -->
            </div>

            <!-- Board / Community Cards -->
            <div id="board">
                <div class="card-slot"></div>
                <div class="card-slot"></div>
                <div class="card-slot"></div>
                <div class="card-slot"></div>
                <div class="card-slot"></div>
            </div>

            <!-- Player Area (Me - Bottom) -->
            <div id="player-area" class="player-area me">
                <div class="bet-chip" id="player-bet"></div>
                <div class="status-bubble" id="player-status"></div>
                <div class="cards" id="player-cards"></div>
                <div class="player-info">
                    <div class="avatar">üë§</div>
                    <div class="details">
                        <span class="name">Syncing...</span>
                        <span class="chips">$0</span>
                    </div>
                </div>
            </div>

            <div id="game-start-controls" style="display:none; text-align:center; margin-top:20px;">
                <button id="btn-start-game"
                    style="padding: 15px 30px; font-size: 1.2rem; background: var(--accent-gold); color: black;">SHUFFLE
                    & DEAL</button>
                <div id="host-waiting-msg" style="color: #ccc; font-style: italic; margin-top: 10px; display: none;">
                    The Host is preparing the deck...</div>
            </div>

            <!-- Controls -->
            <div id="controls" style="display:none;">
                <div class="action-bar">
                    <button class="btn-action fold" data-action="fold">Fold</button>
                    <button class="btn-action check" data-action="check">Check</button>
                    <button class="btn-action call" data-action="call">Call</button>
                    <button class="btn-action raise" data-action="raise">Raise</button>
                </div>
                <!-- Betting Shortcuts -->
                <div id="betting-shortcuts" style="display:none; justify-content:center; gap:5px; margin-top:5px;">
                    <button class="btn-shortcut" data-mult="0.5">1/2 Pot</button>
                    <button class="btn-shortcut" data-mult="1.0">Pot</button>
                    <button class="btn-shortcut" data-action="allin">All-in</button>
                </div>
                <div class="slider-container" id="raise-slider-container" style="display:none;">
                    <span id="slider-label" style="font-size: 0.8rem; color: #ccc;">Amount:</span>
                    <input type="range" id="raise-slider" min="0" max="1000" step="1">
                    <input type="number" id="raise-val" value="0" min="0" style="width:60px;">
                    <button id="btn-confirm-raise">BET</button>
                </div>
                <!-- Hand Strength Indicator -->
                <div id="hand-strength"></div>
            </div>

            <div id="game-overlay" class="overlay" style="display:none;">
                <div class="overlay-content">
                    <h2 id="overlay-msg">Winner!</h2>
                    <button id="btn-next-hand">Next Hand</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Music Player (Restored to User's Style) -->
    <div id="music-player">
        <div class="track-info">
            <span id="track-name">Loading Tracks...</span>
        </div>
        <div class="controls">
            <button id="btn-prev">‚èÆ</button>
            <button id="btn-play">‚ñ∂</button>
            <button id="btn-next">‚è≠</button>
        </div>
        <div class="volume-control">
            <span>üîä</span>
            <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
        </div>
        <audio id="bg-audio" preload="auto"></audio>
    </div>

    <!-- Modals -->
    <div id="modal-guide" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3>Poker Hands Rank</h3>
            <ul class="hands-list">
                <li><strong>Royal Flush</strong> <span>A K Q J 10 (Same Suit)</span></li>
                <li><strong>Straight Flush</strong> <span>5 Consecutive (Same Suit)</span></li>
                <li><strong>Four of a Kind</strong> <span>4 of same Rank</span></li>
                <li><strong>Full House</strong> <span>3 + 2 of same Rank</span></li>
                <li><strong>Flush</strong> <span>5 of Same Suit</span></li>
                <li><strong>Straight</strong> <span>5 Consecutive Rank</span></li>
                <li><strong>Three of a Kind</strong> <span>3 of same Rank</span></li>
                <li><strong>Two Pair</strong> <span>2 + 2 of same Rank</span></li>
                <li><strong>One Pair</strong> <span>2 of same Rank</span></li>
                <li><strong>High Card</strong> <span>Highest Card Wins</span></li>
            </ul>
            <button class="btn-close-modal">Close</button>
        </div>
    </div>

    <div id="tournament-over-overlay" class="modal-overlay" style="display:none;">
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 15px;">üèÜ</div>
            <h2 id="tournament-champ-name"></h2>
            <div class="tournament-actions">
                <button id="btn-reset-game">Start from Scratch</button>
                <button id="btn-back-lobby" class="secondary-btn">New Room</button>
            </div>
        </div>
    </div>

    <div id="modal-stats" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <h3>Player Stats: <span id="stats-name"></span></h3>
            <div class="stats-grid" id="stats-container">
                <div>Hands Played: <span id="stats-played">0</span></div>
                <div>Wins: <span id="stats-wins">0</span></div>
                <div>Win Rate: <span id="stats-rate">0%</span></div>
                <div>Best Hand: <span id="stats-best">N/A</span></div>
            </div>
            <button class="btn-close-modal">Close</button>
        </div>
    </div>

    <!-- Script Versioning to bypass Cache -->
    <script type="module" src="game.js?v=FIN_REV"></script>
</body>

</html>